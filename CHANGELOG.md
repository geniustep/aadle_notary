# ๐ ุณุฌู ุงูุชุบููุฑุงุช - aadle_notary Module

## ๐ฏ ููุฎุต ุงูุชุญุณููุงุช ูุงูุฅุถุงูุงุช

### โ 1. ุฏุนู FastAPI ุงูุฌุฏูุฏ ู Flask ุงููุฏูู

#### FastAPI ุงูุฌุฏูุฏ (`docgen.aadle.com`)
- **Endpoint:** `/docs/render`
- **Payload:**
  ```json
  {
    "template_id": "marriage_contract",
    "data": {...},
    "include_qr": true,
    "include_signature": true
  }
  ```
- **Response:** JSON ูุญุชูู ุนูู `pdf_url` ู `sha256`
- **ูุนุงูุฌุฉ:** ุชุญููู PDF ูู `pdf_url` ุงููุฑุฌุน

#### Flask ุงููุฏูู (`localhost:5000` ุฃู `IP:5000`)
- **Endpoint:** `/api/generate`
- **Payload:**
  ```json
  {
    "template": "marriage_contract",
    "data": {...},
    "format": "pdf"
  }
  ```
- **Response:** PDF ูุจุงุดุฑุฉ ูู response body
- **ูุนุงูุฌุฉ:** ุงุณุชุฎุฏุงู `response.content` ูุจุงุดุฑุฉ

---

### โ 2. ูุธุงู Authentication ูุญุณูู

#### ุฃููููุฉ Authentication:
1. **Session Token** ูู ุฌูุณุฉ ุงููุณุชุฎุฏู ุงูุญุงูู (ุชููุงุฆูุงู)
   - ูุชู ุฃุฎุฐู ูู `http.request.session.session_id`
   - ุฃู ูู `context.session_id`
   - ุฃู ูู `request.session.session_id`

2. **API Token** ูู ุงูุฅุนุฏุงุฏุงุช (`aadle.docgen_api_token`)
   - ููุณุชุฎุฏู ูู Bearer token

3. **API Key** ูู ุงูุฅุนุฏุงุฏุงุช (`aadle.docgen_api_key`)
   - ููุณุชุฎุฏู ูู `X-API-Key` header
   - ุฃู ูู Bearer token (fallback)

#### ุฏุงูุฉ `get_session_token()`:
- 3 ูุญุงููุงุช ููุญุตูู ุนูู session token
- ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก
- ูุนูู ุชููุงุฆูุงู ุนูุฏ ุงูุงุณุชุฏุนุงุก ูู ูุงุฌูุฉ Odoo

---

### โ 3. JSON Sanitization

#### `_sanitize_data_for_json(data)`:
- ุชูุธูู ุดุงูู ููุจูุงูุงุช
- ุฏุนู nested dictionaries ู lists
- ุชุญููู ุงูููู ุบูุฑ JSON-safe ุฅูู ููู ุขููุฉ

#### `_safe_json_value(value)`:
- ุชุญููู ุงูููู ุฅูู JSON-safe format
- ุฏุนู:
  - ุงูุฃููุงุน ุงูุฃุณุงุณูุฉ (int, float, str, bool)
  - ุงูุชูุงุฑูุฎ (date, datetime) โ `YYYY-MM-DD`
  - Odoo recordsets โ string representation
  - None ู False โ ูุชู ุงูุญูุงุธ ุนูููุง

---

### โ 4. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุญุณููุฉ

#### ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ:
- ูุงุฆูุฉ ุจุงูุฎูุงุฏู ุงููุฌุฑุจุฉ
- ุขุฎุฑ ุฎุทุฃ ูุน ุชูุงุตูู
- ูุนูููุงุช ุนู authentication
- ูุตุงุฆุญ ููุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช

#### ูุนุงูุฌุฉ ุฃููุงุน ุงูุฃุฎุทุงุก:
- `ConnectionError` - ูุดู ุงูุงุชุตุงู
- `Timeout` - ุงูุชูุงุก ูููุฉ ุงูุงุชุตุงู
- `SSLError` - ูุดุงูู SSL
- `HTTP errors` - ุฃุฎุทุงุก HTTP (404, 500, etc.)

---

### โ 5. ุชุญุณููุงุช ุฅุถุงููุฉ

#### ุชูุธูู URLs:
- ุฅุฒุงูุฉ ุงููุณุงูุงุช
- ุฅุฒุงูุฉ `/` ูู ุงูููุงูุฉ
- ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ

#### ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ:
- ุฏุนู FastAPI response (JSON ูุน `pdf_url`)
- ุฏุนู Flask response (PDF ูุจุงุดุฑุฉ)
- fallback ููุงุณุชุฌุงุจุฉ ุงููุจุงุดุฑุฉ

#### SSL Verification:
- `verify=True` ููุชุญูู ูู ุดูุงุฏุงุช SSL
- ูุนุงูุฌุฉ ุฃุฎุทุงุก SSL ุจุดูู ูููุตู

---

## ๐ ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ ูู Odoo

### ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ:

```python
# URL ุงูุฎุงุฏู ุงูุฃุณุงุณู
aadle.docgen_url = https://docgen.aadle.com

# URL ุงูุฎุงุฏู ุงูุงุญุชูุงุทู (ุงุฎุชูุงุฑู - ูููู ุชุฑูู ูุงุฑุบุงู)
aadle.docgen_fallback_url = 

# ููุน Authentication
aadle.docgen_auth_type = bearer  # ุฃู 'api_key'

# Bearer Token (ุงุฎุชูุงุฑู - fallback)
aadle.docgen_api_token = 

# API Key (ุงุฎุชูุงุฑู - fallback)
aadle.docgen_api_key = 
```

### ููุงุญุธุงุช:
- **Bearer Token** ูุชู ุฃุฎุฐู ุชููุงุฆูุงู ูู ุฌูุณุฉ ุงููุณุชุฎุฏู
- **fallback_url** ูููู ุชุฑูู ูุงุฑุบุงู
- ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุฃู ุฎูุงุฏูุ ุณูุชู ุงุณุชุฎุฏุงู `https://docgen.aadle.com` ูุงูุชุฑุงุถู

---

## ๐ ููููุฉ ุงูุฅุนุฏุงุฏ

### ูู Terminal:
```bash
cd /opt/odoo18
sudo -u odoo18 bash -c "source venv/bin/activate && python3 odoo/odoo-bin shell -c /etc/odoo18.conf -d aadle --no-http"
```

ุซู:
```python
ICP = env['ir.config_parameter'].sudo()
ICP.set_param('aadle.docgen_url', 'https://docgen.aadle.com')
ICP.set_param('aadle.docgen_auth_type', 'bearer')
```

### ูู Odoo UI:
**Settings โ Technical โ Parameters โ System Parameters**

---

## ๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุฏุนู ูุชุนุฏุฏ ููุฎูุงุฏู
- FastAPI ุงูุฌุฏูุฏ
- Flask ุงููุฏูู
- ุชููุงุฆูุงู ูุญุฏุฏ ููุน ุงูุฎุงุฏู

### 2. Authentication ุชููุงุฆู
- Session token ูู ุฌูุณุฉ ุงููุณุชุฎุฏู
- ูุง ุญุงุฌุฉ ูุฅุนุฏุงุฏู ูุฏููุงู

### 3. ูุนุงูุฌุฉ ุฐููุฉ ููุงุณุชุฌุงุจุฉ
- FastAPI: ุชุญููู ูู URL
- Flask: ุงุณุชุฎุฏุงู ูุจุงุดุฑ
- Fallback ุขูู

### 4. ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ูุนูููุงุช ููุตูุฉ
- ูุตุงุฆุญ ููุญู
- ุญุงูุฉ authentication

---

## ๐ฏ ุงูุงุณุชุฎุฏุงู

1. ุงูุชุญ ูุซููุฉ ูู Odoo
2. ุงุถุบุท ุนูู ุฒุฑ "ุชูููุฏ PDF"
3. ุณูุชู:
   - ุฃุฎุฐ Bearer Token ุชููุงุฆูุงู ูู ุฌูุณุฉ ุงููุณุชุฎุฏู
   - ุชุญุฏูุฏ ููุน ุงูุฎุงุฏู (FastAPI ุฃู Flask)
   - ุฅุฑุณุงู ุงูุทูุจ ุจุงูู payload ุงูููุงุณุจ
   - ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ ุญุณุจ ููุน ุงูุฎุงุฏู
   - ุญูุธ PDF ูู ุงููุซููุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Session Token**: ูุชู ุฃุฎุฐู ุชููุงุฆูุงู ููุท ุนูุฏ ุงูุงุณุชุฏุนุงุก ูู ูุงุฌูุฉ Odoo
2. **FastAPI**: ูุชุทูุจ `pdf_url` ูู ุงูุงุณุชุฌุงุจุฉ
3. **Flask**: ูุชููุน PDF ูุจุงุดุฑุฉ ูู response body
4. **SSL**: ูุชู ุงูุชุญูู ูู ุงูุดูุงุฏุงุช ุชููุงุฆูุงู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูุดู ุชูููุฏ PDF:
1. ุชุญูู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ - ุชุญุชูู ุนูู ูุนูููุงุช ููุตูุฉ
2. ุชุญูู ูู ุญุงูุฉ ุงูุฎูุงุฏู
3. ุชุญูู ูู Bearer Token (ุณูุชู ุฅุธูุงุฑู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ)
4. ุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช ูู Odoo

---

## ๐ ุชุงุฑูุฎ ุงูุชุญุฏูุซุงุช

- **2025-11-09**: ุฅุถุงูุฉ ุฏุนู FastAPI ู Flask
- **2025-11-09**: ุชุญุณูู ูุธุงู Authentication
- **2025-11-09**: ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- **2025-11-09**: ุฅุถุงูุฉ JSON Sanitization

